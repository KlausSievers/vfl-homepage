/*! Help & Manual WebHelp 3 Script functions
Copyright (c) 2014-2016 by Tim Green. All rights reserved. Contact tg@it-authoring.com
*/
function xMsg(i){var b=i+": ",k=/^https??:\/\//im.test(document.location)?"?":"!";var f=document.domain;if(f!=""&&location.protocol!=="file:"){f=location.protocol+"//"+f+(location.port!==""?":"+location.port:"")}else{f="*"}window.returnvalues={};function p(u,r,v){try{var q=typeof u!=="string"?u:u==="parent"?parent:u.indexOf("parent.")===0?parent.frames[u.substr(7)].contentWindow:document.getElementById(u).contentWindow;q.postMessage(r+(v?","+v:""),f)}catch(s){}}function m(s){var r=s;var v=/(.*?)\((.*?|xmsgResult)\){1,1}$|^\w{3,20}/mg,t=v.exec(r);if(t.length>2&&t[2]!==undefined){r=t[1];if(t[2]!==""){var u=t[2].split(",");for(var q=0;q<u.length;q++){r+="|"+u[q]}}else{r+="()"}}return(r)}function o(r){var q=r.split("|"),t=q.shift(),s=q.join();if(s){t=t+"("+s+")"}else{t=t+"()"}return t}function h(r,q,s){if(s&&typeof s==="string"){p(r,"loadTopic,"+q+","+m(s))}else{p(r,"loadTopic,"+q)}}function j(v,t,q){var r=null;var s=0;p(v,"getValue,"+t);if(q&&typeof q==="function"){var u=setInterval(function(){var w=t.replace(/\./g,"_");s++;if(typeof returnvalues[w]!=="undefined"){r=returnvalues[w];delete returnvalues[w];clearInterval(u);q(r);return r}else{if(s>20){clearInterval(u);return"no response"}}},1)}}function g(r,s,q){p(r,"setValue,"+s+"|"+q)}function d(r,s,q){p(r,"returnValue,"+s+"|"+q)}function l(r,q){q=m(q);p(r,"execFunction",q)}function c(t,r){var q=null;switch(t){case"getValue":if(r.indexOf(".")>0){var s=r.split(".");q=window[s[0]][s[1]]?window[s[0]][s[1]]:"null"}else{q=window[r]?window[r]:"null"}return q;break}}function a(q){var r;switch(q){case"true":r=true;break;case"false":r=false;break;case"null":r=null;break;default:r=q}return r}function n(v,u){var q,s,r;function t(){q=v.split("|");s=q.shift();q.forEach(function(y,x,w){if(q[x].indexOf("*")==0){q[x]=q[x].replace(/^\*/,"")}else{if(q[x]==" "){q[x]="''"}else{q[x]="'"+q[x]+"'"}}});q=q.join()}switch(u){case"execlocalfunction":t();r=new Function("if (typeof "+s+" != 'function') return;"+s+"("+q+");");break;case"setlocalvalue":t();r=new Function("if (typeof "+s+" == 'undefined') { console.log('called unknown value: "+s.toString()+"'); return;};"+s+" = "+q);break;case"receivevalue":t();q=a(q);r=new Function("window.returnvalues['"+s+"'] = "+q);break;case"getlocalvalue":s=v;r=new Function("if (typeof "+s+" == 'undefined') return null;if (typeof "+s+" !== 'string') return '*' +"+s+"; else return "+s+";");break}return r}function e(q){q=q||window.event;if(typeof q.data!=="string"){return}var w=document.location.protocol;if(w.substr(0,4)==="http"&&q.origin!=f){return}var v=q.data.split(",");var y=q.source;var x=null;if(v[2]&&v[2]!=="undefined"){x=new Function(o(v[2]))}switch(v[0]){case"loadTopic":History.pushState(null,null,v[1]);if(x){var s=(v[1].split(k)[0]).replace(/^.*?\.\/(.+$)/ig,"$1");var u=0;var r=setInterval(function(){u++;if(hmFlags.hmCurrentPage===s){clearInterval(r);u=0;x()}if(u>20){clearInterval(r);u=0}},5)}break;case"getValue":var t=n(v[1],"getlocalvalue");d(q.source,v[1].replace(/\./g,"_"),t());break;case"setValue":var t=n(v[1],"setlocalvalue");t();if(x){x()}break;case"returnValue":var t=n(v[1],"receivevalue");t();if(x){x()}break;case"execFunction":var t=o(v[1]);t=new Function(t);t();if(x){x()}break}}if(window.addEventListener){window.addEventListener("message",e,false)}else{(window.attachEvent("onmessage",e))}return{getValue:j,setValue:g,sendMessage:p,loadTopic:h,callFunction:l}};
